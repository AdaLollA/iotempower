#!/usr/bin/env bash

[ "$ULNOIOT_ACTIVE" = "yes" ] || { echo "ulnoiot not active, aborting." 1>&2;exit 1; }

TS=ts
if which moreutils_ts; then
    TS=moreutils_ts
fi

topic="$1"
outfile="${topic//\//_}.log"
echo "Logging to $outfile."
mosquitto_sub  -h "$ULNOIOT_MQTT_HOST" -t "$topic" | \
    $TS "%.s" | tee -a "$outfile"
