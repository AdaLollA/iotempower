#!/bin/bash
# push files to the wemos
# $1 file $2 destination $3 port (optional)
#

# find directory and read config
dir=$(cd -P -- "$(dirname -- "$0")" && pwd -P)
ULNOIOT_ROOT="$dir/.."
source "$ULNOIOT_ROOT/bin/read_config"


port=$("$dir/find_esp_port" "$3")

srcpath=$(dirname "$1")
srcname=$(basename "$1")

destpath=$(dirname "$2")
destname=$(basename "$2")

echo "Pushing $1 to $2."
cd "$srcpath"
mpfshell -n -c "
  open tty$port;
  cd "$destpath";
  put "\""$srcname"\"" "\""$destname"\""
  "
