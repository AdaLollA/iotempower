#!/bin/bash
# open a repl terminal on the given port (USB..) or ip address
# $1: suggested port or host

[ "$ULNOIOT_ACTIVE" = "yes" ] || { echo "ulnoiot not active, aborting." 1>&2;exit 1; }

if [ -e "node.conf" ]; then # started from node-directory -> network connect
    source "$ULNOIOT_ROOT/bin/read_config"
    ip=$(get_ip "$topic" 2>/dev/null|grep "$topic"|cut -d\  -f2)
    if [ "$ip" ]; then
        echo "Connecting to node $topic with ip $ip."
        tail -n1 key.hex | console_netrepl "$ip"
    else
        echo "Couldn't find IP of node with topic $topic."
        echo "If connected via serial or usb, try console_serial."
        exit 1
    fi
else
    console_serial "$1"
fi
