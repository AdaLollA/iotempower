#!/bin/bash
# deploy esp8266 micropython
# this needs to be called from the download directory

# specify here, which version to flash - the actual flash uses wildcards to find the file
version="1.8.3"
# wemos has 32m-bit=4m-byte flash
# seems to have 4m-byte: http://www.wemos.cc/Products/d1_mini.html
flash_size=32
tty=/dev/ttyUSB0
# 115200 seems safer and prevents problems with lesser quality ttl converters
baudrate=115200

# TODO: think about an autodownload

echo Performing erase flash.
esptool-ulno --port "$tty" erase_flash
echo Flash erased, press enter.
read tmp
echo Performing firmware flash.
esptool-ulno --port "$tty" \
    --baud "$baudrate" write_flash --flash_size="$flash_size"m --verify \
    0 esp8266-*$version.bin
